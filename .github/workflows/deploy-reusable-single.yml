name: Deploy Infrastructure (Single Step)

on:
  workflow_call:
    inputs:
      environment:
        required: true
        type: string
      repo_name:
        required: true
        type: string
    secrets:
      KOMODO_API_URL:
        required: true

env:
  ENVIRONMENT: ${{ inputs.environment }}
  REPO_NAME: ${{ inputs.repo_name }}

jobs:
  validate:
    name: Validate Configuration
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Validate inputs
        run: |
          echo "Environment: ${{ inputs.environment }}"
          echo "Repo: ${{ inputs.repo_name }}"
          if [[ ! "${{ inputs.environment }}" =~ ^[a-z0-9-]+$ ]]; then
            echo "::error::Invalid environment"
            exit 1
          fi
          echo "âœ… Inputs validated"
